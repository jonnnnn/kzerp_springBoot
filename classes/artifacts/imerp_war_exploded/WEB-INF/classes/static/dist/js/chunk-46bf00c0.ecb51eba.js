(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46bf00c0"],{7080:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"abow_dialog",attrs:{title:e.pageTitle,"close-on-click-modal":!1,visible:e.visible,width:"80%"},on:{"update:visible":function(t){e.visible=t}}},[a("div",[a("dynamic-form",{ref:"dataForm",attrs:{formprops:e.formprops,"col-span":"8,8,8","read-only":e.formReadOnly,alldescriptors:e.descriptors},model:{value:e.dataForm,callback:function(t){e.dataForm=t},expression:"dataForm"}})],1),a("vxe-grid",{ref:"sGrid",staticClass:"vxe-table-element",attrs:{border:"",resizable:"",size:"mini","highlight-current-row":"","remote-filter":"",toolbar:e.toolbar,"proxy-config":e.tableProxy,"edit-rules":e.validRules,"edit-config":{trigger:"dblclick",mode:"cell"},columns:e.tableColumn,"select-config":{reserve:!0},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isTab:!0,isEdit:!0},"footer-cell-class-name":e.footerCellClassName,"footer-method":e.footerMethod,"show-footer":""},on:{"edit-closed":e.editClosed},scopedSlots:e._u([{key:"buttons",fn:function(){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit && (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:function(t){return e.$refs.sGrid.insert({})}}},[e._v("新增")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit &&  (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.removeSelecteds(e.$refs.sGrid)}}},[e._v("删除")])]},proxy:!0}])}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"primary",disabled:e.btnDisable},on:{click:e.dataFormSubmit}},[e._v("确定")])],1)],1)},i=[],o=(a("cc57"),a("9d30"),a("163d"),a("e1a58")),l=(a("be17"),{type:"separate"}),s={mixins:[o["a"]],data:function(){return{mixinViewModuleOptions:{getDataListURL:"/pur/poline/list",updateURL:"/pur/poheader/save",prodURL:"/base/product/search",deleteIsBatch:!0,getDataListIsPage:!1},visible:!1,btnDisable:!1,pageTitle:"采购单新增",dataForm:{orderType:"PO_ORDER",vendorId:"",contactName:"",contactPhone:"",agentId:"",planDeliveryDate:"",orderQty:"",realQty:"",totalAcceptQty:"",costPrice:""},descriptors:{orderNum:{type:"string",label:"采购单号",disabled:"disabled",props:{clearable:!0}},agentId:{type:"cust",label:"采购员",name:"im-selector",props:{mapKeyVal:"agentName:agentId",dataType:"biz.employee",clearable:!0},required:!0},separate1:l,vendorId:{type:"cust",label:"供应商",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"vendorName:vendorId",dataType:"biz.vendor",clearable:!0},required:!0},contactName:{type:"string",label:"供应商联系人",props:{clearable:!0}},contactPhone:{type:"string",label:"供应商联系电话",props:{clearable:!0}},separate2:l,payType:{type:"cust",label:"运费付款方式",name:"im-selector",props:{mapKeyVal:"payType",dataType:"code.SHIP_PAYTYPE",clearable:!0}},shipType:{type:"cust",label:"发运方式",name:"im-selector",ruletype:"integer",props:{mapKeyVal:"shipType",dataType:"dict.SHIP_TYPE",clearable:!0}},shipId:{type:"cust",label:"发运公司",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"shipName:shipId",dataType:"biz.shipComp",clearable:!0}},separate3:l,shipNum:{type:"string",label:"发运单号",props:{clearable:!0}},freight:{type:"string",label:"运费",props:{clearable:!0}},separate4:l,remark:{type:"string",label:"备注",colspan:3}},tableProxy:{autoLoad:!1},validRules:{prodname:[{required:!0,message:"商品必填"}],prodno:[{required:!0,message:"商品必填"}],orderQty:[{required:!0,message:"下单数必填"},{type:"number",message:"请输入数字"}],costPrice:[{required:!0,message:"采购价必填"},{type:"number",message:"请输入数字"}],realQty:[{validator:function(e,t,a,r){var i=r.row;t&&Number(t)>Number(i.orderQty)-Number(i.totalAcceptQty)?a(new Error("收货数不能大于剩余收货数")):a()}}]},tableColumn:[{type:"selection",width:30,align:"center"},{type:"index",width:40,align:"center"},{title:"商品编码",field:"prodno",sortable:!0,align:"center"},{title:"商品名称",field:"name",sortable:!0,align:"center",editRender:{name:"ElAutocomplete",props:{fetchSuggestions:this.prodSeach,triggerOnFocus:!1,popperClass:"prod-popper"},events:{select:this.handleProcSelect},autoselect:!0},footerRender:function(e,t){return"汇总"}},{title:"包装单位",field:"unit",sortable:!0,align:"center"},{title:"规格",field:"specialParam",sortable:!0,align:"center"},{title:"生产厂家",field:"manufacture",width:"110px",align:"left"},{title:"批准文号",field:"approvalno",width:"110px",align:"left"},{title:"业务类型",field:"busitypetext",width:"110px",align:"center"},{title:"灭菌批号",field:"sterilization",width:"110px",align:"center"},{title:"订单数量",field:"orderQty",sortable:!0,align:"center",formatter:this.formatter,editRender:{name:"input"},footerRender:this.footerSum},{title:"采购价",field:"costPrice",sortable:!0,align:"right",formatter:this.formatterMoney,editRender:{name:"input"}},{title:"采购总金额",field:"totalPrice",align:"right",formatter:this.formatterMoney,editPost:function(e,t){var a=t.orderQty,r=t.costPrice;if(!Number.isNaN(a)&&!Number.isNaN(r))return Number(a)*Number(r).toFixed(2)},footerRender:this.footerSum},{title:"备注",field:"note",align:"center",width:"130px",editRender:{name:"input",autoselect:!0}}],toolbar:{id:"full_edit_1",resizable:{storage:!0},setting:{storage:!0}}}},methods:{prodSeach:function(e,t){var a=this;e&&this.$axios.post(this.mixinViewModuleOptions.prodURL,{name:e}).then((function(e){for(var r=0;r<e.length;r++)e[r].value=e[r].allString;clearTimeout(a.timeout),a.timeout=setTimeout((function(){t(e)}),100*Math.random())}))},handleProcSelect:function(e,t){var a=e.row;t&&(Object.assign(a,t),a.productId=t.id,a.productName=t.name,a.uom=t.unit)},initCB:function(){var e=this;this.pageTitle=this.isNew?"采购单新增":"采购单修改",this.$nextTick((function(){if(e.isNew)e.$refs.dataForm.readOnly(!1);else if("NEW"===e.entityModel.status)e.$refs.dataForm.readOnly(!1);else{if("SUBMIT"===e.entityModel.status||"SENDED"===e.entityModel.status)return e.entityModel.saveType="pick",e.enableSubmit=!0,e.pageTitle="采购单收货",e.$refs.dataForm.readOnly(!0,["shipId","shipType","payType","shipNum","freight","isAuto","remark"]),delete e.tableColumn[3].editRender,delete e.tableColumn[11].editRender,Object.assign(e.tableColumn[13],{editRender:{name:"input"}}),void e.$refs.sGrid.loadColumn(e.tableColumn);e.$refs.dataForm.readOnly(!0)}delete e.dataForm.saveType,e.$refs.sGrid.loadColumn(e.tableColumn)}))}},computed:{},mounted:function(){}},n=s,d=a("623f"),c=function(e){e.options.__source="src/views/pur/poheader-add-or-update.vue"},p=c,u=Object(d["a"])(n,r,i,!1,null,null,null);"function"===typeof p&&p(u);t["default"]=u.exports},"9d30":function(e,t,a){var r=a("e46b");r(r.S,"Number",{isNaN:function(e){return e!=e}})}}]);