(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fd9c258","chunk-75c11260"],{"453c":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"abow_dialog",attrs:{title:e.pageTitle,"close-on-click-modal":!1,visible:e.visible,width:"80%"},on:{"update:visible":function(t){e.visible=t}}},[r("div",[r("dynamic-form",{ref:"dataForm",attrs:{formprops:e.formprops,"col-span":"8,8,8","read-only":e.formReadOnly,alldescriptors:e.descriptors},model:{value:e.dataForm,callback:function(t){e.dataForm=t},expression:"dataForm"}})],1),r("vxe-grid",{ref:"sGrid",staticClass:"vxe-table-element",attrs:{border:"",resizable:"",size:"mini","highlight-current-row":"","remote-filter":"",toolbar:e.toolbar,"proxy-config":e.tableProxy,"edit-rules":e.validRules,"edit-config":{trigger:"dblclick",mode:"cell"},columns:e.tableColumn,"select-config":{reserve:!0},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isTab:!0,isEdit:!0},"footer-cell-class-name":e.footerCellClassName,"footer-method":e.footerMethod,"show-footer":""},on:{"edit-closed":e.editClosed},scopedSlots:e._u([{key:"buttons",fn:function(){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit && (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:function(t){return e.$refs.sGrid.insert({})}}},[e._v("新增")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit &&  (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.removeSelecteds(e.$refs.sGrid)}}},[e._v("删除")])]},proxy:!0}])}),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"primary",disabled:e.btnDisable},on:{click:e.dataFormSubmit}},[e._v("确定")])],1)],1)},i=[],o=(r("9d30"),r("163d"),r("e1a58")),n=(r("be17"),{type:"separate"}),s={mixins:[o["a"]],data:function(){return{mixinViewModuleOptions:{getDataListURL:"/pur/poline/list",updateURL:"/pur/poheader/save",prodURL:"/base/product/search",deleteIsBatch:!0,getDataListIsPage:!1},visible:!1,btnDisable:!1,pageTitle:"采购退货单新增",dataForm:{orderType:"PO_RETURN",vendorId:"",contactName:"",contactPhone:"",agentId:"",warehouseId:"",planDeliveryDate:"",payType:null,shipType:null,shipName:null,shipId:null,shipNum:null,freight:null,isAuto:!0,remark:""},descriptors:{orderNum:{type:"string",label:"采购退货单号",disabled:"disabled",props:{clearable:!0}},agentId:{type:"cust",label:"负责人",name:"im-selector",props:{mapKeyVal:"agentName:agentId",dataType:"biz.employee",clearable:!0},required:!0},warehouseId:{type:"cust",label:"退货仓库",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"warehouseCode:warehouseId",dataType:"biz.warehouse",clearable:!0},required:!0},separate1:n,vendorId:{type:"cust",label:"供应商",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"vendorName:vendorId",dataType:"biz.vendor",clearable:!0},required:!0},contactName:{type:"string",label:"供应商联系人",props:{clearable:!0}},contactPhone:{type:"string",label:"供应商联系电话",props:{clearable:!0}},separate2:n,payType:{type:"cust",label:"运费付款方式",name:"im-selector",props:{mapKeyVal:"payType",dataType:"code.SHIP_PAYTYPE",clearable:!0}},shipType:{type:"cust",label:"发运方式",name:"im-selector",ruletype:"integer",props:{mapKeyVal:"shipType",dataType:"dict.SHIP_TYPE",clearable:!0}},shipId:{type:"cust",label:"发运公司",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"shipName:shipId",dataType:"biz.shipComp",clearable:!0}},separate3:n,shipNum:{type:"string",label:"发运单号",props:{clearable:!0}},freight:{type:"string",label:"运费",props:{clearable:!0}},isAuto:{label:"拣货方式",type:"boolean",required:!0,props:{inactiveText:"人工",activeText:"自动"}},separate4:n,remark:{type:"string",label:"备注",colspan:3}},tableProxy:{autoLoad:!1},validRules:{productCode:[{required:!0,message:"物料必填"}],orderQty:[{required:!0,message:"退货数必填"},{type:"number",message:"请输入数字"}],costPrice:[{required:!0,message:"退货价必填"},{type:"number",message:"请输入数字"}],acceptQty:[{validator:function(e,t,r,a){var i=a.row;t&&Math.abs(Number(t))>Math.abs(Number(i.orderQty))-Math.abs(Number(i.totalAcceptQty))?r(new Error("退货数不能大于剩余退货数")):r()}}]},tableColumn:[{type:"selection",width:30,align:"center"},{type:"index",width:30,align:"center"},{title:"商品",field:"productCode",sortable:!0,align:"center",editRender:{name:"ElAutocomplete",props:{fetchSuggestions:this.prodSeach,triggerOnFocus:!1,popperClass:"prod-popper"},events:{select:this.handleProcSelect}},footerRender:function(e,t){return"汇总"}},{title:"单位",field:"uom",sortable:!0,align:"center"},{title:"物料描述",field:"description",sortable:!0,align:"center"},{title:"退货数",field:"orderQty",sortable:!0,align:"center",editRender:{name:"input"},editPost:function(e,t){var r=t.orderQty;if(!Number.isNaN(r))return-Math.abs(Number(r))},footerRender:this.footerSum},{title:"累计退货数",field:"totalAcceptQty",sortable:!0,align:"center",editPost:function(e,t){var r=t.totalAcceptQty;if(!Number.isNaN(r))return-Math.abs(Number(r))},footerRender:this.footerSum},{title:"实际退货数",field:"acceptQty",sortable:!0,align:"center",editRender:{name:"input"},editPost:function(e,t){var r=t.acceptQty;if(!Number.isNaN(r))return-Math.abs(Number(r))},footerRender:this.footerSum},{title:"退货价",field:"costPrice",sortable:!0,align:"right",formatter:this.formatterMoney,editRender:{name:"input"}},{title:"退货总金额",field:"totalPrice",align:"right",formatter:this.formatterMoney,editPost:function(e,t){var r=t.orderQty,a=t.costPrice;if(!Number.isNaN(r)&&!Number.isNaN(a))return Number(r)*Number(a).toFixed(2)},footerRender:this.footerSum},{title:"货位",field:"warehouseSlotId",sortable:!0,align:"center"}],toolbar:{id:"full_edit_1",resizable:{storage:!0},setting:{storage:!0}}}},methods:{prodSeach:function(e,t){var r=this;e&&this.$axios.post(this.mixinViewModuleOptions.prodURL,{name:e,warehouseId:this.dataForm.warehouseId}).then((function(e){for(var a=0;a<e.length;a++)e[a].value=e[a].val;clearTimeout(r.timeout),r.timeout=setTimeout((function(){t(e)}),100*Math.random())}))},handleProcSelect:function(e,t){var r=e.row;t&&(Object.assign(r,t),r.uom=t.unit,r.productId=t.id,r.productCode=t.code)},initCB:function(){var e=this;this.pageTitle=this.isNew?"采购退货单新增":"采购退货单修改",this.$nextTick((function(){if(e.isNew)e.$refs.dataForm.readOnly(!1);else if("NEW"===e.entityModel.status)e.$refs.dataForm.readOnly(!1);else{if("SUBMIT"===e.entityModel.status||"SENDED"===e.entityModel.status)return e.entityModel.saveType="pick",e.enableSubmit=!0,e.pageTitle="采购退货单退货",e.$refs.dataForm.readOnly(!0,["shipId","shipType","payType","shipNum","freight","isAuto","remark"]),delete e.tableColumn[2].editRender,delete e.tableColumn[5].editRender,Object.assign(e.tableColumn[7],{editRender:{name:"input"}}),void e.$refs.sGrid.loadColumn(e.tableColumn);e.$refs.dataForm.readOnly(!0)}delete e.dataForm.saveType,delete e.tableColumn[7].editRender,Object.assign(e.tableColumn[5],{editRender:{name:"input"}}),Object.assign(e.tableColumn[2],{editRender:{name:"ElAutocomplete",props:{fetchSuggestions:e.prodSeach,triggerOnFocus:!1,popperClass:"prod-popper"},events:{select:e.handleProcSelect},autoselect:!0}}),e.$refs.sGrid.loadColumn(e.tableColumn)}))}},mounted:function(){}},l=s,d=r("623f"),c=function(e){e.options.__source="src/views/pur/poreturnheader-add-or-update.vue"},u=c,p=Object(d["a"])(l,a,i,!1,null,null,null);"function"===typeof u&&u(p);t["default"]=p.exports},"9d30":function(e,t,r){var a=r("e46b");a(a.S,"Number",{isNaN:function(e){return e!=e}})},ada5:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",[r("el-collapse",{attrs:{slot:"header"},slot:"header"},[r("el-collapse-item",[r("template",{slot:"title"},[e._v("\n\t\t\t\t查询条件"),r("i",{staticClass:"el-icon-d-arrow-right"})]),r("dynamic-form",{ref:"dataForm",attrs:{formprops:e.formprops,"col-span":"6,6,6,*",alldescriptors:e.descriptors},model:{value:e.dataForm,callback:function(t){e.dataForm=t},expression:"dataForm"}},[r("template",{slot:"btnsearch"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],2)],2)],1),r("vxe-grid",{ref:"pGrid",attrs:{border:"",resizable:"","highlight-current-row":"","remote-filter":"",size:"mini","row-id":"id",toolbar:e.toolbar,"proxy-config":e.tableProxy,columns:e.tableColumn,"select-config":{reserve:!0},"edit-config":{trigger:"click",mode:"row",showStatus:!0}},on:{"cell-dblclick":e.cellDblClick,"current-change":e.currentChange},scopedSlots:e._u([{key:"buttons",fn:function(){return[e.$hasPermission("pur:poreturnheader:save")?r("el-button",{ref:"btnStatusAdd",attrs:{enablestatus:"NEW,SUBMIT,SENDED,COMPLETED",size:"mini",icon:"el-icon-circle-plus"},on:{click:e.addHandle}},[e._v("新增\n\t\t\t")]):e._e(),e.$hasPermission("pur:poreturnheader:save")?r("el-button",{ref:"btnStatusEdit",attrs:{enablestatus:"NEW","row-dbclick":"","form-readonly":"",type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.cellDblClick({row:e.$refs.pGrid.getCurrentRow()},t)}}},[e._v("修改\n\t\t\t")]):e._e(),e.$hasPermission("pur:poheader:submit")?r("el-button",{ref:"btnStatusSubmit",attrs:{enablestatus:"NEW",type:"success",size:"mini",icon:"el-icon-check"},on:{click:function(t){return e.submitPoHandle(e.$refs.pGrid,!0)}}},[e._v("提交\n\t\t\t")]):e._e(),e.$hasPermission("pur:poreturnheader:delete")?r("el-button",{ref:"btnStatusDelete",attrs:{enablestatus:"NEW",type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteEntityHandle(e.$refs.pGrid)}}},[e._v("删除\n\t\t\t")]):e._e(),e.$hasPermission("pur:poheader:submit")?r("el-button",{ref:"btnStatusPick",attrs:{enablestatus:"SUBMIT,SENDED",type:"success",size:"mini",icon:"el-icon-check"},on:{click:function(t){return e.cellDblClick({row:e.$refs.pGrid.getCurrentRow()},t)}}},[e._v("退货\n\t\t\t")]):e._e(),e.$hasPermission("pur:poheader:rollback")?r("el-button",{ref:"btnStatusRollback",attrs:{enablestatus:"SENDED",type:"warning",size:"mini",icon:"fa fa-undo"},on:{click:function(t){return e.rollbackHandle(e.$refs.pGrid)}}},[e._v("撤回\n\t\t\t")]):e._e(),r("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-printer"}},[e._v("打印\n\t\t\t")]),r("el-button",{attrs:{type:"info",size:"mini",icon:"fa fa-file-excel-o"},on:{click:function(t){return e.$refs.pGrid.exportCsv()}}},[e._v(" 导出\n\t\t\t")])]},proxy:!0}])}),r("el-pagination",{attrs:{slot:"footer","current-page":e.page,"page-sizes":[10,20,50,100],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":function(t){return e.pageSizeChangeHandle(t,"vxe")},"current-change":function(t){return e.pageCurrentChangeHandle(t,"vxe")}},slot:"footer"}),e.addOrUpdateVisible?r("add-or-update",{ref:"addOrUpdate",on:{refreshDataList:e.search}}):e._e()],1)},i=[],o=(r("6491"),r("c0c3"),r("453c")),n=r("e1a58"),s={type:"separate"},l={name:"pur-poreturnheader",mixins:[n["a"]],data:function(){return{mixinViewModuleOptions:{getDataListURL:"/pur/poheader/list",getDataListIsPage:!0,updateURL:"/pur/poheader/save",submitURL:"/pur/poheader/submit",submitPoURL:"/pur/poheader/posubmit",rollbackURL:"/pur/poheader/rollback",exportURL:"/pur/poheader/export"},order:"desc",orderField:"id",dataForm:{orderType:"PO_RETURN",orderNum:"",vendorId:"",warehouseId:"",vendorName:"",status:""},descriptors:{orderNum:{type:"string",label:"退货单号",props:{clearable:!0}},vendorId:{type:"cust",label:"供应商",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"vendorName:vendorId",dataType:"biz.vendor",clearable:!0}},status:{type:"cust",label:"单据状态",placeholder:"请选择状态",name:"im-selector",props:{mapKeyVal:"status",dataType:"code.status",clearable:!0}},separate1:s,warehouseId:{type:"cust",label:"退货仓库",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"warehouseCode:warehouseId",dataType:"biz.warehouse",clearable:!0}},orderDate:{type:"date",label:"退货日期",colspan:2,props:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"yyyy-MM-dd",class:"input-class"}},btnSearch:{type:"slot",name:"btnsearch"}},tableColumn:[{type:"index",width:30,align:"center"},{title:"退货单号",field:"orderNum",sortable:!0,align:"center"},{title:"供应商",field:"vendorName",sortable:!0,align:"center"},{title:"退货仓库",field:"warehouseCode",sortable:!0,align:"center"},{title:"退货日期",field:"orderDate",sortable:!0,align:"center",formatter:["toDateString","yyyy-MM-dd"]},{title:"负责人",field:"agentName",sortable:!0,align:"center"},{title:"计划退回日期",field:"planDeliveryDate",sortable:!0,align:"center",formatter:["toDateString","yyyy-MM-dd"]},{title:"状态",field:"statusMean",sortable:!0,align:"center"},{title:"退货总金额",field:"orderAmount",sortable:!0,align:"right",formatter:this.formatterMoney,footerRender:this.footerSum},{title:"总运费",field:"totalFreight",sortable:!0,align:"right",formatter:this.formatterMoney,footerRender:this.footerSum},{title:"修改人",field:"updateBy",sortable:!0,align:"center"},{title:"修改日期",field:"updateDate",sortable:!0,align:"center",formatter:["toDateString","yyyy-MM-dd"]}],toolbar:{id:"full_edit_1",refresh:!0,resizable:{storage:!0},setting:{storage:!0}}}},components:{AddOrUpdate:o["default"]},methods:{reset:function(){this.$refs.dataForm.resetFields()},submitPoHandle:function(e){var t=this,r=this.pGrid.getCurrentRow();if(!r)return this.$message({message:"请选择要提交的记录",type:"warning"});this.$confirm("确定要提交吗，提交后不能在修改！","操作提示",{confirmButtonText:this.$t("views.public.confirm"),cancelButtonText:this.$t("views.public.cancel"),type:"info"}).then((function(){t.$axios.post(t.mixinViewModuleOptions.submitPoURL,{id:r.id}).then((function(e){t.$message({message:t.$t("views.public.success"),type:"success",duration:500,onClose:function(){t.search()}})})).catch((function(){}))})).catch((function(){}))},cellDblClick:function(e,t){var r=this,a=e.row;if("undefined"===typeof a||null===a)return this.$message({message:"请选择要操作的记录",type:"error"});a.isAuto=!0,this.addOrUpdateVisible=!0,this.$nextTick((function(){var e=null;for(var t in r.$refs)if(t.startsWith("btnStatus")){var i=r.$refs[t].$attrs["row-dbclick"];if(e=r.$refs[t].$attrs["form-readonly"],e="undefined"!==typeof e&&null!==e,"undefined"!==typeof i&&null!==i&&"none"===r.$refs[t].$el.style.display)return void r.$refs.addOrUpdate.init(a,e,!1)}r.$refs.addOrUpdate.init(a,e)}))}},mounted:function(){}},d=l,c=r("623f"),u=function(e){e.options.__source="src/views/pur/poreturnheader.vue"},p=u,m=Object(c["a"])(d,a,i,!1,null,null,null);"function"===typeof p&&p(m);t["default"]=m.exports}}]);