(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e20c3dc","chunk-46bf00c0"],{4298:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",[r("el-collapse",{attrs:{slot:"header"},slot:"header"},[r("el-collapse-item",[r("template",{slot:"title"},[e._v("\n\t\t\t\t\t查询条件"),r("i",{staticClass:"el-icon-d-arrow-right"})]),r("dynamic-form",{ref:"dataForm",attrs:{formprops:e.formprops,"col-span":"6,6,6,*",alldescriptors:e.descriptors},model:{value:e.dataForm,callback:function(t){e.dataForm=t},expression:"dataForm"}},[r("template",{slot:"btnsearch"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],2)],2)],1),r("vxe-grid",{ref:"pGrid",attrs:{border:"",resizable:"","highlight-current-row":"","remote-filter":"",size:"mini","row-id":"id",toolbar:e.toolbar,"proxy-config":e.tableProxy,columns:e.tableColumn,"select-config":{reserve:!0},"edit-config":{trigger:"click",mode:"row",showStatus:!0}},on:{"cell-dblclick":e.cellDblClick,"current-change":e.currentChange},scopedSlots:e._u([{key:"buttons",fn:function(){return[e.$hasPermission("pur:poheader:save")?r("el-button",{ref:"btnStatusAdd",attrs:{enablestatus:"NEW,SUBMIT,SENDED,COMPLETED",size:"mini",icon:"el-icon-circle-plus"},on:{click:e.addHandle}},[e._v("新增\n\t\t\t\t")]):e._e(),e.$hasPermission("pur:poheader:submit")?r("el-button",{ref:"btnStatusSubmit",attrs:{enablestatus:"NEW",type:"success",size:"mini",icon:"el-icon-check"},on:{click:function(t){return e.submitPoHandle(e.$refs.pGrid,!0)}}},[e._v("提交\n\t\t\t\t")]):e._e(),e.$hasPermission("pur:poheader:delete")?r("el-button",{ref:"btnStatusDelete",attrs:{enablestatus:"NEW",type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteEntityHandle(e.$refs.pGrid)}}},[e._v("删除\n\t\t\t\t")]):e._e(),r("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-printer"}},[e._v("打印\n\t\t\t\t")]),r("el-button",{attrs:{type:"info",size:"mini",icon:"fa fa-file-excel-o"},on:{click:function(t){return e.$refs.pGrid.exportCsv()}}},[e._v(" 导出\n\t\t\t\t")])]},proxy:!0}])}),r("el-pagination",{attrs:{slot:"footer","current-page":e.page,"page-sizes":[10,20,50,100],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":function(t){return e.pageSizeChangeHandle(t,"vxe")},"current-change":function(t){return e.pageCurrentChangeHandle(t,"vxe")}},slot:"footer"}),e.addOrUpdateVisible?r("add-or-update",{ref:"addOrUpdate",on:{refreshDataList:e.search}}):e._e()],1)},i=[],o=(r("6491"),r("c0c3"),r("7080")),n=r("e1a58"),l={type:"separate"},s={name:"pur-poheader",mixins:[n["a"]],data:function(){return{mixinViewModuleOptions:{getDataListURL:"/pur/poheader/list",getDataListIsPage:!0,updateURL:"/pur/poheader/save",submitURL:"/pur/poheader/submit",submitPoURL:"/pur/poheader/posubmit",rollbackURL:"/pur/poheader/rollback",exportURL:"/pur/poheader/export"},order:"desc",orderField:"id",dataForm:{orderType:"PO_ORDER",orderNum:"",vendorId:"",custname:"",vendorName:"",status:""},descriptors:{orderNum:{type:"string",label:"采购单号",props:{clearable:!0}},vendorId:{type:"cust",label:"供应商",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"vendorName:vendorId",dataType:"biz.vendor",clearable:!0}},status:{type:"cust",label:"单据状态",placeholder:"请选择状态",name:"im-selector",props:{mapKeyVal:"status",dataType:"code.status",clearable:!0}},separate1:l,warehouseId:{type:"cust",label:"仓库",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"warehouseCode:warehouseId",dataType:"biz.warehouse",clearable:!0}},orderDate:{type:"date",label:"采购日期",colspan:2,props:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"yyyy-MM-dd",class:"input-class"}},btnSearch:{type:"slot",name:"btnsearch"}},tableColumn:[{type:"index",width:30,align:"center"},{title:"采购日期",field:"orderDate",sortable:!0,align:"center",formatter:["toDateString","yyyy-MM-dd"]},{title:"采购单号",field:"orderNum",sortable:!0,align:"center"},{title:"供应商",field:"custname",sortable:!0,align:"center"},{title:"状态",field:"statusMean",sortable:!0,align:"center"},{title:"采购员",field:"agentname",sortable:!0,align:"center"},{title:"采购总金额",field:"orderAmount",sortable:!0,align:"right",formatter:this.formatterMoney,footerRender:this.footerSum},{title:"备注",field:"remark",sortable:!0,align:"right",footerRender:this.footerSum},{title:"修改人",field:"updateBy",sortable:!0,align:"center"},{title:"修改日期",field:"updateDate",sortable:!0,align:"center",formatter:["toDateString","yyyy-MM-dd"]}],toolbar:{id:"full_edit_1",refresh:!0,resizable:{storage:!0},setting:{storage:!0}}}},components:{AddOrUpdate:o["default"]},methods:{reset:function(){this.$refs.dataForm.resetFields()},submitPoHandle:function(e){var t=this,r=this.pGrid.getCurrentRow();if(!r)return this.$message({message:"请选择要提交的记录",type:"warning"});this.$confirm("确定要提交吗，提交后不能在修改！","操作提示",{confirmButtonText:this.$t("views.public.confirm"),cancelButtonText:this.$t("views.public.cancel"),type:"info"}).then((function(){t.$axios.post(t.mixinViewModuleOptions.submitPoURL,{id:r.id}).then((function(e){t.$message({message:t.$t("views.public.success"),type:"success",duration:500,onClose:function(){t.search()}})})).catch((function(){}))})).catch((function(){}))},cellDblClick:function(e,t){var r=this,a=e.row;if("undefined"===typeof a||null===a)return this.$message({message:"请选择要操作的记录",type:"error"});a.isAuto=!0,this.addOrUpdateVisible=!0,this.$nextTick((function(){var e=null;for(var t in r.$refs)if(t.startsWith("btnStatus")){var i=r.$refs[t].$attrs["row-dbclick"];if(e=r.$refs[t].$attrs["form-readonly"],e="undefined"!==typeof e&&null!==e,"undefined"!==typeof i&&null!==i&&"none"===r.$refs[t].$el.style.display)return void r.$refs.addOrUpdate.init(a,e,!1)}r.$refs.addOrUpdate.init(a,e)}))}},mounted:function(){}},d=s,c=r("623f"),u=function(e){e.options.__source="src/views/pur/poheader.vue"},p=u,m=Object(c["a"])(d,a,i,!1,null,null,null);"function"===typeof p&&p(m);t["default"]=m.exports},7080:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"abow_dialog",attrs:{title:e.pageTitle,"close-on-click-modal":!1,visible:e.visible,width:"80%"},on:{"update:visible":function(t){e.visible=t}}},[r("div",[r("dynamic-form",{ref:"dataForm",attrs:{formprops:e.formprops,"col-span":"8,8,8","read-only":e.formReadOnly,alldescriptors:e.descriptors},model:{value:e.dataForm,callback:function(t){e.dataForm=t},expression:"dataForm"}})],1),r("vxe-grid",{ref:"sGrid",staticClass:"vxe-table-element",attrs:{border:"",resizable:"",size:"mini","highlight-current-row":"","remote-filter":"",toolbar:e.toolbar,"proxy-config":e.tableProxy,"edit-rules":e.validRules,"edit-config":{trigger:"dblclick",mode:"cell"},columns:e.tableColumn,"select-config":{reserve:!0},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isTab:!0,isEdit:!0},"footer-cell-class-name":e.footerCellClassName,"footer-method":e.footerMethod,"show-footer":""},on:{"edit-closed":e.editClosed},scopedSlots:e._u([{key:"buttons",fn:function(){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit && (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:function(t){return e.$refs.sGrid.insert({})}}},[e._v("新增")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit&&"SUBMIT"!==e.entityModel.status&&"SENDED"!==e.entityModel.status,expression:"enableSubmit &&  (entityModel.status !== 'SUBMIT' && entityModel.status !== 'SENDED')"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.removeSelecteds(e.$refs.sGrid)}}},[e._v("删除")])]},proxy:!0}])}),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],attrs:{type:"primary",disabled:e.btnDisable},on:{click:e.dataFormSubmit}},[e._v("确定")])],1)],1)},i=[],o=(r("cc57"),r("9d30"),r("163d"),r("e1a58")),n=(r("be17"),{type:"separate"}),l={mixins:[o["a"]],data:function(){return{mixinViewModuleOptions:{getDataListURL:"/pur/poline/list",updateURL:"/pur/poheader/save",prodURL:"/base/product/search",deleteIsBatch:!0,getDataListIsPage:!1},visible:!1,btnDisable:!1,pageTitle:"采购单新增",dataForm:{orderType:"PO_ORDER",vendorId:"",contactName:"",contactPhone:"",agentId:"",planDeliveryDate:"",orderQty:"",realQty:"",totalAcceptQty:"",costPrice:""},descriptors:{orderNum:{type:"string",label:"采购单号",disabled:"disabled",props:{clearable:!0}},agentId:{type:"cust",label:"采购员",name:"im-selector",props:{mapKeyVal:"agentName:agentId",dataType:"biz.employee",clearable:!0},required:!0},separate1:n,vendorId:{type:"cust",label:"供应商",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"vendorName:vendorId",dataType:"biz.vendor",clearable:!0},required:!0},contactName:{type:"string",label:"供应商联系人",props:{clearable:!0}},contactPhone:{type:"string",label:"供应商联系电话",props:{clearable:!0}},separate2:n,payType:{type:"cust",label:"运费付款方式",name:"im-selector",props:{mapKeyVal:"payType",dataType:"code.SHIP_PAYTYPE",clearable:!0}},shipType:{type:"cust",label:"发运方式",name:"im-selector",ruletype:"integer",props:{mapKeyVal:"shipType",dataType:"dict.SHIP_TYPE",clearable:!0}},shipId:{type:"cust",label:"发运公司",ruletype:"integer",name:"im-selector",props:{mapKeyVal:"shipName:shipId",dataType:"biz.shipComp",clearable:!0}},separate3:n,shipNum:{type:"string",label:"发运单号",props:{clearable:!0}},freight:{type:"string",label:"运费",props:{clearable:!0}},separate4:n,remark:{type:"string",label:"备注",colspan:3}},tableProxy:{autoLoad:!1},validRules:{prodname:[{required:!0,message:"商品必填"}],prodno:[{required:!0,message:"商品必填"}],orderQty:[{required:!0,message:"下单数必填"},{type:"number",message:"请输入数字"}],costPrice:[{required:!0,message:"采购价必填"},{type:"number",message:"请输入数字"}],realQty:[{validator:function(e,t,r,a){var i=a.row;t&&Number(t)>Number(i.orderQty)-Number(i.totalAcceptQty)?r(new Error("收货数不能大于剩余收货数")):r()}}]},tableColumn:[{type:"selection",width:30,align:"center"},{type:"index",width:40,align:"center"},{title:"商品编码",field:"prodno",sortable:!0,align:"center"},{title:"商品名称",field:"name",sortable:!0,align:"center",editRender:{name:"ElAutocomplete",props:{fetchSuggestions:this.prodSeach,triggerOnFocus:!1,popperClass:"prod-popper"},events:{select:this.handleProcSelect},autoselect:!0},footerRender:function(e,t){return"汇总"}},{title:"包装单位",field:"unit",sortable:!0,align:"center"},{title:"规格",field:"specialParam",sortable:!0,align:"center"},{title:"生产厂家",field:"manufacture",width:"110px",align:"left"},{title:"批准文号",field:"approvalno",width:"110px",align:"left"},{title:"业务类型",field:"busitypetext",width:"110px",align:"center"},{title:"灭菌批号",field:"sterilization",width:"110px",align:"center"},{title:"订单数量",field:"orderQty",sortable:!0,align:"center",formatter:this.formatter,editRender:{name:"input"},footerRender:this.footerSum},{title:"采购价",field:"costPrice",sortable:!0,align:"right",formatter:this.formatterMoney,editRender:{name:"input"}},{title:"采购总金额",field:"totalPrice",align:"right",formatter:this.formatterMoney,editPost:function(e,t){var r=t.orderQty,a=t.costPrice;if(!Number.isNaN(r)&&!Number.isNaN(a))return Number(r)*Number(a).toFixed(2)},footerRender:this.footerSum},{title:"备注",field:"note",align:"center",width:"130px",editRender:{name:"input",autoselect:!0}}],toolbar:{id:"full_edit_1",resizable:{storage:!0},setting:{storage:!0}}}},methods:{prodSeach:function(e,t){var r=this;e&&this.$axios.post(this.mixinViewModuleOptions.prodURL,{name:e}).then((function(e){for(var a=0;a<e.length;a++)e[a].value=e[a].allString;clearTimeout(r.timeout),r.timeout=setTimeout((function(){t(e)}),100*Math.random())}))},handleProcSelect:function(e,t){var r=e.row;t&&(Object.assign(r,t),r.productId=t.id,r.productName=t.name,r.uom=t.unit)},initCB:function(){var e=this;this.pageTitle=this.isNew?"采购单新增":"采购单修改",this.$nextTick((function(){if(e.isNew)e.$refs.dataForm.readOnly(!1);else if("NEW"===e.entityModel.status)e.$refs.dataForm.readOnly(!1);else{if("SUBMIT"===e.entityModel.status||"SENDED"===e.entityModel.status)return e.entityModel.saveType="pick",e.enableSubmit=!0,e.pageTitle="采购单收货",e.$refs.dataForm.readOnly(!0,["shipId","shipType","payType","shipNum","freight","isAuto","remark"]),delete e.tableColumn[3].editRender,delete e.tableColumn[11].editRender,Object.assign(e.tableColumn[13],{editRender:{name:"input"}}),void e.$refs.sGrid.loadColumn(e.tableColumn);e.$refs.dataForm.readOnly(!0)}delete e.dataForm.saveType,e.$refs.sGrid.loadColumn(e.tableColumn)}))}},computed:{},mounted:function(){}},s=l,d=r("623f"),c=function(e){e.options.__source="src/views/pur/poheader-add-or-update.vue"},u=c,p=Object(d["a"])(s,a,i,!1,null,null,null);"function"===typeof u&&u(p);t["default"]=p.exports},"9d30":function(e,t,r){var a=r("e46b");a(a.S,"Number",{isNaN:function(e){return e!=e}})}}]);